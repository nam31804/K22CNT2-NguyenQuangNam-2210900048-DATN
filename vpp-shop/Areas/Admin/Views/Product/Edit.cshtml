@model vpp_shop.Models.Product
@{
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<h1 class="h3 mb-4 text-gray-800">Cập nhật sản phẩm</h1>

<div class="card shadow mb-4">
    <div class="card-body">
        <form asp-area="Admin"
              asp-controller="Product"
              asp-action="Edit"
              method="post"
              enctype="multipart/form-data">

            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="Id" />

            <!-- DANH MỤC -->
            <div class="mb-3">
                <label class="form-label fw-bold">Danh mục</label>
                <select asp-for="CategoryId" class="form-select">
                    <option value="0">-- Chọn thể loại --</option>
                    @foreach (var c in ViewBag.Categories)
                    {
                        <option value="@c.Id">@c.Name</option>
                    }
                </select>
                <span class="text-danger">
                    @Html.ValidationMessageFor(m => m.CategoryId)
                </span>
            </div>

            <!-- TÊN -->
            <div class="mb-3">
                <label class="form-label fw-bold">Tên sản phẩm</label>
                <input asp-for="Name"
                       class="form-control"
                       placeholder="Nhập tên sản phẩm" />
                <span class="text-danger">
                    @Html.ValidationMessageFor(m => m.Name)
                </span>
            </div>

            <!-- GIÁ -->
            <div class="mb-3">
                <label class="form-label fw-bold">Giá (VNĐ)</label>
                <input asp-for="Price"
                       type="number"
                       step="0.01"
                       class="form-control" />
                <span class="text-danger">
                    @Html.ValidationMessageFor(m => m.Price)
                </span>
            </div>

            <!-- SỐ LƯỢNG TỒN -->
            <div class="mb-3">
                <label class="form-label fw-bold">Số lượng tồn</label>
                <input asp-for="Stock"
                       type="number"
                       class="form-control" />
            </div>

            <!-- ✅ MÔ TẢ SẢN PHẨM (THÊM) -->
            <div class="mb-3">
                <label class="form-label fw-bold">Mô tả sản phẩm</label>
                <textarea asp-for="Description"
                          class="form-control"
                          rows="4"
                          placeholder="Nhập mô tả sản phẩm..."></textarea>
            </div>

            <!-- ẢNH -->
            <div class="mb-4">
                <label class="form-label fw-bold">Ảnh đại diện</label>

                <!-- INPUT FILE ẨN -->
                <input type="file"
                       id="imageFile"
                       name="imageFile"
                       accept="image/*"
                       hidden
                       onchange="handleImageChange(this)" />

                <!-- BOX UPLOAD -->
                <div id="uploadBox"
                     onclick="document.getElementById('imageFile').click()"
                     class="border rounded d-flex align-items-center justify-content-center"
                     style="width:100%;height:180px;cursor:pointer;overflow:hidden;background:#fafafa">

                    <!-- PLACEHOLDER -->
                    <div id="uploadPlaceholder"
                         class="text-center"
                         style="@(string.IsNullOrEmpty(Model.Image) ? "" : "display:none")">
                        <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                        <div>Bấm để đổi ảnh</div>
                    </div>

                    <!-- ẢNH HIỆN TẠI -->
                    <img id="previewImage"
                         src="@(string.IsNullOrEmpty(Model.Image) ? "" : "/images/products/" + Model.Image)"
                         style="@(string.IsNullOrEmpty(Model.Image) ? "display:none" : "display:block");
                                max-width:100%;
                                max-height:100%;
                                object-fit:contain;" />
                </div>
            </div>

            <!-- BUTTON -->
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary px-4">
                    <i class="fas fa-save me-1"></i> Cập nhật
                </button>

                <a asp-area="Admin"
                   asp-controller="Product"
                   asp-action="Index"
                   class="btn btn-secondary px-4">
                    Quay lại
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    function handleImageChange(input) {
        if (input.files && input.files[0]) {
            const preview = document.getElementById('previewImage');
            const placeholder = document.getElementById('uploadPlaceholder');

            preview.src = URL.createObjectURL(input.files[0]);
            preview.style.display = 'block';
            placeholder.style.display = 'none';
        }
    }
</script>
